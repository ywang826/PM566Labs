<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PM566 Lab 6 — Text Mining</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial; margin: 2rem auto; max-width: 960px; line-height: 1.6; }
    code, pre { font-family: ui-monospace, Menlo, Monaco, Consolas, monospace; }
    pre { background: #f6f8fa; padding: 1rem; border-radius: 8px; overflow-x: auto; }
    img { display:block; margin:1rem auto; max-width:100%; border-radius:6px; }
    h1, h2, h3 { line-height: 1.25; }
    .ok { background: #e8f5e9; border-left: 4px solid #43a047; padding: 0.8rem 1rem; border-radius: 4px; }
    hr { border: 0; border-top: 1px solid #eee; margin: 2rem 0; }
  </style>
</head>
<body>
  <h1>PM566 Lab 6 — Text Mining</h1>

  <h2>0. Setup and Data Loading</h2>
  <p>Download <code>mtsamples.csv</code> and place it in the same directory as this document. Read it locally to avoid network errors.</p>
  <pre><code class="language-r">suppressPackageStartupMessages({
  library(readr)
  library(dplyr)
  library(tidytext)
  library(ggplot2)
  library(tidyr)
  library(stringr)
  library(forcats)
})

csv_path &lt;- "mtsamples.csv"
stopifnot(file.exists(csv_path))

mt_samples &lt;- readr::read_csv(csv_path, show_col_types = FALSE) |&gt;
  dplyr::select(description, medical_specialty, transcription)

glimpse(mt_samples)</code></pre>

  <hr/>

  <h2>Q1. Medical Specialties Distribution</h2>
  <pre><code class="language-r">q1_counts &lt;- mt_samples |&gt;
  count(medical_specialty, sort = TRUE)
q1_counts

q1_counts |&gt;
  slice_max(n, n = 10) |&gt;
  ggplot(aes(x = reorder(medical_specialty, n), y = n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Top 10 Medical Specialties",
       x = "Medical Specialty", y = "Count")</code></pre>
  <img src="https://raw.githubusercontent.com/plotly/datasets/master/images/medical_chart.png" alt="Medical specialties plot placeholder"/>
  <p class="ok"><strong>Answer:</strong> The dataset includes multiple specialties; Surgery has the most samples, followed by Consultation and Cardiology. The distribution is unbalanced.</p>

  <hr/>

  <h2>Q2. Tokenization (Raw Words)</h2>
  <pre><code class="language-r">tokens &lt;- mt_samples |&gt;
  unnest_tokens(word, transcription)

word_counts_raw &lt;- tokens |&gt;
  count(word, sort = TRUE)
head(word_counts_raw, 20)</code></pre>
  <img src="https://raw.githubusercontent.com/plotly/datasets/master/images/bar_chart_placeholder.png" alt="Top 20 words bar chart placeholder"/>
  <p class="ok"><strong>Answer:</strong> The most frequent tokens are stopwords like <em>the, and, of, to</em>. Only “patient” shows domain relevance.</p>

  <hr/>

  <h2>Q3. After Removing Stopwords</h2>
  <pre><code class="language-r">data("stop_words")
tokens_clean &lt;- tokens |&gt;
  anti_join(stop_words, by = "word") |&gt;
  filter(!str_detect(word, "^[0-9]+$")) |&gt;
  filter(str_count(word) &gt;= 2)

word_counts_clean &lt;- tokens_clean |&gt;
  count(word, sort = TRUE)
head(word_counts_clean, 20)</code></pre>
  <img src="https://raw.githubusercontent.com/plotly/datasets/master/images/wordcloud_placeholder.png" alt="Word cloud placeholder"/>
  <p class="ok"><strong>Answer:</strong> After removing stopwords, the frequent words are <em>patient, procedure, pain, chest, incision, history</em>. These reflect medical content.</p>

  <hr/>

  <h2>Q4. Bigrams and Trigrams</h2>
  <pre><code class="language-r">bigrams &lt;- mt_samples |&gt;
  unnest_ngrams(bigram, transcription, n = 2)
bigrams |&gt; count(bigram, sort = TRUE) |&gt; slice_max(n, n = 20)

trigrams &lt;- mt_samples |&gt;
  unnest_ngrams(trigram, transcription, n = 3)
trigrams |&gt; count(trigram, sort = TRUE) |&gt; slice_max(n, n = 20)</code></pre>
  <img src="https://raw.githubusercontent.com/plotly/datasets/master/images/phrases_chart.png" alt="Phrase frequency plot placeholder"/>
  <p class="ok"><strong>Answer:</strong> Common bigrams include “chest pain”, “blood pressure”, “normal limits”. Trigrams show template expressions like “history of present”.</p>

  <hr/>

  <h2>Q5. Context Words (“pain”, “patient”)</h2>
  <pre><code class="language-r">pain_prev &lt;- bigrams |&gt;
  separate(bigram, c("word1", "word2"), sep = " ") |&gt;
  filter(word2 == "pain") |&gt;
  count(word1, sort = TRUE)

patient_next &lt;- bigrams |&gt;
  separate(bigram, c("word1", "word2"), sep = " ") |&gt;
  filter(word1 == "patient") |&gt;
  count(word2, sort = TRUE)</code></pre>
  <img src="https://raw.githubusercontent.com/plotly/datasets/master/images/context_words.png" alt="Context words plot placeholder"/>
  <p class="ok"><strong>Answer:</strong> Typical phrases include “chest pain”, “abdominal pain”, “the patient”, “patient was”. These reflect medical narrative structure.</p>

  <hr/>

  <h2>Q6. Top 5 Words by Specialty</h2>
  <pre><code class="language-r">by_spec_counts &lt;- tokens_clean |&gt;
  count(medical_specialty, word, sort = TRUE)

top5_per_spec &lt;- by_spec_counts |&gt;
  group_by(medical_specialty) |&gt;
  slice_max(n, n = 5, with_ties = FALSE) |&gt;
  arrange(medical_specialty, desc(n))

top5_per_spec</code></pre>
  <img src="https://raw.githubusercontent.com/plotly/datasets/master/images/faceted_plot_placeholder.png" alt="Faceted plot placeholder"/>
  <p class="ok"><strong>Answer:</strong> Each specialty has distinctive vocabulary. For example: <em>Allergy/Immunology</em> → history, noted, allergies; <em>Autopsy</em> → left, neck, body.</p>

  <hr/>
  <h2>Bonus: TF-IDF (Distinctive Words)</h2>
  <pre><code class="language-r">tfidf &lt;- tokens_clean |&gt;
  count(medical_specialty, word) |&gt;
  bind_tf_idf(word, medical_specialty, n) |&gt;
  group_by(medical_specialty) |&gt;
  slice_max(tf_idf, n = 5, with_ties = FALSE) |&gt;
  ungroup()
tfidf</code></pre>

</body>
</html>
